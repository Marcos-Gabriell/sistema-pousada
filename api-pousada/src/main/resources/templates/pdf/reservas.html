<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8"/>

    <style>
        /* ✅ aumenta um pouco a margem inferior pra “reservar” o footer */
        @page { size: A4; margin: 18mm 14mm 26mm 14mm; }

        * { box-sizing: border-box; }

        body{
            font-family: Arial, sans-serif;
            font-size: 12px;
            font-weight: 400;
            color:#111;
            margin:0;
            padding:0;
            line-height:1.35;
        }

        .container{ width:100%; }
        .avoid-break{ page-break-inside: avoid; }
        .muted{ color:#555; }

        /* ===== RAID (header + meta) ===== */
        .header{
            border-bottom:2px solid #111;
            padding-bottom:10px;
            margin-bottom:12px;
            display:table;
            width:100%;
        }
        .header-left,.header-right{ display:table-cell; vertical-align:middle; }
        .header-left{ width:65%; }
        .header-right{ width:35%; text-align:right; }

        .brand{ display:table; width:100%; }
        .brand-logo,.brand-text{ display:table-cell; vertical-align:middle; }
        .brand-logo{ width:78px; }

        .logo{
            width:64px;
            height:64px;
            border-radius:14px;
            border:1px solid #e5e7eb;
            display:block;
        }

        .brand-title{
            font-size:14px;
            font-weight:600;
            margin:0;
            line-height:1.2;
        }
        .brand-subtitle{
            font-size:11px;
            color:#555;
            margin:2px 0 0;
        }

        .report-title{
            font-size:18px;
            font-weight:600;
            margin:0;
            line-height:1.2;
        }
        .report-chip{
            display:inline-block;
            margin-top:6px;
            padding:3px 10px;
            font-size:10px;
            font-weight:500;
            border:1px solid #e5e7eb;
            border-radius:999px;
            background:#f8fafc;
            color:#333;
        }

        .meta{
            margin:10px 0 16px;
            padding:12px;
            border:1px solid #e5e7eb;
            border-radius:12px;
            background:#fafafa;
        }
        .meta-row{ display:table; width:100%; table-layout:fixed; }
        .meta-item{ display:table-cell; width:33.33%; padding-right:10px; }

        .meta-label{
            font-size:10px;
            font-weight:500;
            color:#666;
            text-transform:uppercase;
            letter-spacing:.3px;
            margin:0 0 4px;
        }
        .meta-value{
            font-size:12px;
            font-weight:600;
            margin:0;
        }
        .meta-muted{
            font-size:11px;
            color:#555;
            margin:4px 0 0;
        }

        /* ===== Sections ===== */
        .section-title{
            font-size:13px;
            font-weight:600;
            margin:14px 0 8px;
            padding-left:10px;
            border-left:3px solid #111;
        }

        /* ===== KPI GRID (igual Geral) ===== */
        .kpi-grid{
            width:100%;
            display:table;
            table-layout:fixed;
            border-spacing:10px;
            margin:0 0 8px;
        }
        .kpi{
            display:table-cell;
            vertical-align:top;
            padding:12px 12px 10px;
            border:1px solid #e5e7eb;
            border-radius:12px;
            background:#fff;
        }
        .kpi .kpi-title{
            font-size:10px;
            color:#666;
            text-transform:uppercase;
            letter-spacing:.3px;
            margin:0 0 6px;
            font-weight:500;
        }
        .kpi .kpi-value{
            font-size:14px;
            font-weight:600;
            margin:0;
            line-height:1.1;
        }
        .kpi .kpi-hint{
            margin-top:6px;
            font-size:10px;
            color:#666;
            line-height:1.25;
        }

        /* ===== Table (igual Geral) ===== */
        table{
            width:100%;
            border-collapse:collapse;
            margin-top:8px;
            border:1px solid #e5e7eb;
            table-layout:fixed;
        }
        th,td{
            border-bottom:1px solid #e5e7eb;
            padding:8px;
            font-size:11px;
            vertical-align:top;
            word-break: break-word;
        }
        th{
            background:#f3f4f6;
            text-align:left;
            font-size:11px;
            font-weight:500;
        }
        tbody tr:nth-child(even) td{ background:#fafafa; }
        .center{ text-align:center; }

        /* ✅ essenciais pra não “quebrar” feio */
        thead { display: table-header-group; }
        tfoot { display: table-footer-group; }
        tr { page-break-inside: avoid; }

        /* ===== Footer FIXO ===== */
        .pdf-footer{
            position: fixed;
            left:14mm;
            right:14mm;
            bottom:10mm;
            border-top:1px solid #e5e7eb;
            padding-top:6px;
            font-size:10px;
            font-weight:400;
            color:#666;
            display:block;
        }
        .footer-left{ float:left; }
        .footer-center{ float:left; margin-left:18px; }
        .footer-right{ float:right; }
        .sep{ margin:0 6px; color:#999; }
        .clearfix::after{ content:""; display:block; clear:both; }

        .page-number:before{ content: counter(page); }
        .page-count:before{ content: counter(pages); }
    </style>
</head>

<body>
<div class="container">

    <!-- RAID (PADRÃO GLOBAL) -->
    <div th:replace="pdf/fragments/raid :: raid(
        'Relatório de Reservas',
        'Histórico de Reservas',
        ${r},
        ${pousadaNome},
        ${pousadaSubtitulo}
    )"></div>

    <!-- KPIs -->
    <div class="section-title">Indicadores principais</div>

    <div class="kpi-grid avoid-break">
        <div class="kpi">
            <p class="kpi-title">Pendentes</p>
            <p class="kpi-value" th:text="${r.resumo.pendentes}">0</p>
            <div class="kpi-hint">Aguardando confirmação/pagamento.</div>
        </div>

        <div class="kpi">
            <p class="kpi-title">Confirmadas</p>
            <p class="kpi-value" th:text="${r.resumo.confirmadas}">0</p>
            <div class="kpi-hint">Reservas aprovadas no período.</div>
        </div>

        <div class="kpi">
            <p class="kpi-title">Canceladas</p>
            <p class="kpi-value" th:text="${r.resumo.canceladas}">0</p>
            <div class="kpi-hint">Reservas canceladas no período.</div>
        </div>

        <div class="kpi">
            <p class="kpi-title">Taxa de conversão (%)</p>
            <p class="kpi-value">
                <span th:text="${#numbers.formatDecimal(r.resumo.taxaConversao,1,'POINT',2,'COMMA')}">0,00</span>%
            </p>
            <div class="kpi-hint">Confirmadas ÷ Total (no período).</div>
        </div>
    </div>

    <!-- TABELA -->
    <div class="section-title">Reservas</div>

    <table>
        <thead>
        <tr>
            <th style="width:14%;">Código</th>
            <th style="width:28%;">Hóspede</th>
            <th style="width:10%;">Quarto</th>
            <th style="width:14%;">Criada em</th>
            <th style="width:14%;">Check-in</th>
            <th style="width:20%;">Status</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="l : ${r.linhas}">
            <td th:text="${l.codigo}">R-0001</td>
            <td th:text="${l.hospede}">Fulano</td>
            <td th:text="${l.quarto}">101</td>
            <td th:text="${l.criadaEm != null ? #temporals.format(l.criadaEm,'dd/MM/yyyy') : ''}">02/11/2025</td>
            <td th:text="${l.checkinPrevisto != null ? #temporals.format(l.checkinPrevisto,'dd/MM/yyyy') : ''}">10/11/2025</td>
            <td th:text="${l.status}">PENDENTE</td>
        </tr>

        <tr th:if="${#lists.isEmpty(r.linhas)}">
            <td colspan="6" class="center muted" style="padding:12px;">
                Sem reservas no período.
            </td>
        </tr>
        </tbody>
    </table>

</div>

<!-- FOOTER PADRÃO GLOBAL -->
<div th:replace="pdf/fragments/footer :: footer(${pousadaNome}, ${r.geradoEm}, ${r.geradoPor})"></div>

</body>
</html>
