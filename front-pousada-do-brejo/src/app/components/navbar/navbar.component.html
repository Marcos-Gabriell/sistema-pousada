<div
  class="fixed inset-0 bg-black/60 z-40 transition-opacity md:hidden"
  *ngIf="sidebarOpen"
  (click)="sidebarOpen = false"
></div>

<div
  [ngClass]="{
    'translate-x-0': sidebarOpen,
    '-translate-x-full': !sidebarOpen,
    'md:w-60 lg:w-64 xl:w-72': !isCollapsedDesktop,
    'md:w-20 lg:w-20 xl:w-20 sidebar-collapsed': isCollapsedDesktop
  }"
  class="fixed top-0 left-0 z-50 w-full transition-transform duration-300
         md:translate-x-0 md:static
         h-dvh md:h-dvh
         md:shadow-xl flex flex-col
         overflow-y-auto overscroll-contain
         sidebar-shell"
>
  <div class="flex justify-end items-center p-6 md:hidden">
    <button
      (click)="sidebarOpen = false"
      class="text-[var(--accent-yellow)] hover:text-white focus:outline-none transition"
    >
      <svg
        class="w-10 h-10"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
  </div>

  <div class="flex-1 flex flex-col pt-4 lg:pt-5 pb-4">
    <div class="mt-1 flex flex-col items-center px-4">
      <img
        src="assets/logo-branca.png"
        class="w-40 lg:w-48 xl:w-56 h-auto mb-2"
        alt="Logo"
      />

      <button
        (click)="alternarTema()"
        class="sidebar-theme-toggle mb-6 mt-2"
        title="Alternar tema"
      >
        <svg
          *ngIf="temaAtual === 'escuro'"
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5 sidebar-icon-theme"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m0-12.728l.707.707m12.021 12.021l.707.707M12 8a4 4 0 100 8 4 4 0 000-8z"
          />
        </svg>

        <svg
          *ngIf="temaAtual === 'claro'"
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5 sidebar-icon-theme"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2.5"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"
          />
        </svg>
      </button>
    </div>

    <nav class="w-full flex flex-col gap-2 lg:gap-2.5 px-4 md:px-4">
      <!-- DASHBOARD -->
      <a
        routerLink="/dashboard"
        [routerLinkActive]="'sidebar-item-active'"
        [routerLinkActiveOptions]="{ exact: true }"
        class="sidebar-item"
      >
        <ng-container *ngTemplateOutlet="iconHome"></ng-container>
        <span class="truncate sidebar-item-text">Dashboard</span>
      </a>

      <!-- HOSPEDAGENS -->
      <a
        routerLink="/hospedagens"
        [routerLinkActive]="'sidebar-item-active'"
        class="sidebar-item"
      >
        <ng-container *ngTemplateOutlet="iconBriefcase"></ng-container>
        <span class="truncate sidebar-item-text">Hospedagens</span>
      </a>

      <!-- QUARTOS -->
      <a
        routerLink="/quartos"
        [routerLinkActive]="'sidebar-item-active'"
        class="sidebar-item"
      >
        <ng-container *ngTemplateOutlet="iconBed"></ng-container>
        <span class="truncate sidebar-item-text">Quartos</span>
      </a>

      <!-- FINANCEIRO -->
      <a
        routerLink="/financeiro"
        [routerLinkActive]="'sidebar-item-active'"
        class="sidebar-item"
      >
        <ng-container *ngTemplateOutlet="iconDollarSign"></ng-container>
        <span class="truncate sidebar-item-text">Financeiro</span>
      </a>

      <!-- RESERVAS -->
      <a
        routerLink="/reservas"
        [routerLinkActive]="'sidebar-item-active'"
        [routerLinkActiveOptions]="{ exact: true }"
        class="sidebar-item"
      >
        <ng-container *ngTemplateOutlet="iconCalendar"></ng-container>
        <span class="truncate sidebar-item-text">Reservas</span>
      </a>

      <!-- USUÁRIOS -->
      <a
        *ngIf="isAdmin"
        routerLink="/usuarios"
        [routerLinkActive]="'sidebar-item-active'"
        [routerLinkActiveOptions]="{ exact: true }"
        class="sidebar-item"
      >
        <ng-container *ngTemplateOutlet="iconUsers"></ng-container>
        <span class="truncate sidebar-item-text">Usuários</span>
      </a>

      <!-- RELATÓRIOS -->
      <a
        routerLink="/relatorios"
        [routerLinkActive]="'sidebar-item-active'"
        class="sidebar-item"
      >
        <ng-container *ngTemplateOutlet="iconBarChart"></ng-container>
        <span class="truncate sidebar-item-text">Relatórios</span>
      </a>
    </nav>

    <!-- RODAPÉ DA SIDEBAR (VERSÃO) -->
    <div class="mt-auto px-4 pb-4 pt-6 text-center sidebar-footer">
      <span class="block text-xs font-medium text-[var(--text-dim)] opacity-70">
        v{{ versao }}
      </span>
    </div>
  </div>
</div>

<!-- ICONES -->
<ng-template #iconHome>
  <svg
    class="w-5 h-5 sidebar-icon"
    fill="none"
    stroke="currentColor"
    stroke-width="2.2"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"
    />
    <path
      d="M9 22V12h6v10"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</ng-template>

<ng-template #iconBriefcase>
  <svg
    class="w-5 h-5 sidebar-icon"
    fill="none"
    stroke="currentColor"
    stroke-width="2.2"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <rect width="20" height="14" x="2" y="7" rx="2" ry="2" />
    <path
      d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"
      stroke-linecap="round"
    />
  </svg>
</ng-template>

<ng-template #iconBed>
  <svg
    class="w-5 h-5 sidebar-icon"
    fill="none"
    stroke="currentColor"
    stroke-width="2.2"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path
      d="M2 4v16M2 8h20M2 12h20M2 16h20M2 20h20"
      stroke-linecap="round"
      opacity="0"
    />
    <rect x="2" y="7" width="20" height="15" rx="2" ry="2" />
    <path d="M2 12h20M12 7V2" stroke-linecap="round" />
    <path d="M6 16v-4h12v4" stroke-linecap="round" />
  </svg>
</ng-template>

<ng-template #iconDollarSign>
  <svg
    class="w-5 h-5 sidebar-icon"
    fill="none"
    stroke="currentColor"
    stroke-width="2.2"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path
      d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</ng-template>

<ng-template #iconCalendar>
  <svg
    class="w-5 h-5 sidebar-icon"
    fill="none"
    stroke="currentColor"
    stroke-width="2.2"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
    <path d="M16 2v4M8 2v4M3 10h18" stroke-linecap="round" />
  </svg>
</ng-template>

<ng-template #iconUsers>
  <svg
    class="w-5 h-5 sidebar-icon"
    fill="none"
    stroke="currentColor"
    stroke-width="2.2"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
    <circle cx="9" cy="7" r="4" />
    <path
      d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"
    />
  </svg>
</ng-template>

<ng-template #iconBarChart>
  <svg
    class="w-5 h-5 sidebar-icon"
    fill="none"
    stroke="currentColor"
    stroke-width="2.2"
    viewBox="0 0 24 24"
    aria-hidden="true"
  >
    <path
      d="M12 20V10M18 20V4M6 20v-4"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
    <path
      d="M3 20h18"
      stroke-linecap="round"
      stroke-linejoin="round"
    />
  </svg>
</ng-template>

<!-- BOTÃO ABRIR SIDEBAR (MOBILE) -->
<button
  class="fixed top-5 left-5 z-[9999] md:hidden p-1 rounded-lg
         bg-transparent hover:bg-black/10 dark:hover:bg-white/10
         transition pointer-events-auto"
  (click)="sidebarOpen = true"
  *ngIf="!sidebarOpen"
  aria-label="Abrir menu"
>
  <svg
    class="w-9 h-9 drop-shadow-md"
    fill="none"
    stroke="currentColor"
    [ngClass]="{
      'text-black': temaAtual === 'claro',
      'text-white': temaAtual === 'escuro'
    }"
    stroke-width="2.5"
    viewBox="0 0 24 24"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      d="M4 6h16M4 12h16M4 18h16"
    />
  </svg>
</button>

<!-- SETA COLAPSE/EXPANDIR FORA DA NAVBAR (SÓ DESKTOP) -->
<button
  type="button"
  class="hidden md:flex sidebar-toggle-desktop
         fixed z-[70] top-6
         items-center justify-center
         w-9 h-9 rounded-full
         shadow-lg transition-all duration-300"
  [ngClass]="{
    'left-60 lg:left-64 xl:left-72': !isCollapsedDesktop,
    'left-20': isCollapsedDesktop
  }"
  (click)="toggleDesktopCollapse()"
  [title]="isCollapsedDesktop ? 'Expandir menu' : 'Recolher menu'"
>
  <svg
    class="w-4 h-4 transition-transform duration-300"
    [ngClass]="{ 'rotate-180': isCollapsedDesktop }"
    fill="none"
    stroke="currentColor"
    stroke-width="2.3"
    viewBox="0 0 24 24"
  >
    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
  </svg>
</button>
